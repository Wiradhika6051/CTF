## Challenge Name: internal web
>Category: Web Exploitation

>Points: 488

>Solves: 10

### Challenge Description: 

You definitely can't access my internal website, can you?

http://34.101.174.85:10005

Artifact Files:
* [nginx.conf](https://ctf.compfest.id/files/333a3b229c2a5ff0733409c0e2b2703b/nginx.conf?token=eyJ1c2VyX2lkIjoxMCwidGVhbV9pZCI6bnVsbCwiZmlsZV9pZCI6MTR9.ZNBpxQ.aTTFzyZ3dS1CIn28LxBY2D-sWWg)

### Approach

**1. Analyze the website?**

Mari kita coba buka websitenya
![website](internal%20web-1.JPG)
Hanya web startup nginx biasa.

**2. Analyze NGINX Configuration**

Alhamdulillah nya dikasih file config NGINX
```
user nobody;
worker_processes  auto;

events {
  worker_connections  1024;
}

http {
  sendfile     on;
  tcp_nopush   on;
  server_names_hash_bucket_size 128;

  server {
    listen       80;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }
  }

  server {
    listen       80;
    server_name  internal-admin1.compfest.id;

    location /flag {
      alias   /var/www/rahasia/;
    }
  }

}
```
Dari file ini terlihat ada 2 buah server, yang pertam bisa diakses umum dan yang kedua hanya bisa via internal-admin1.compfest.id. Server pertama itu yang kita akses tadi.

Setelah ku analisa dan bertanya di google dan chatGPT sepertinya ku menemukan exploit disini, yakni pada bagian:
```
    location /flag {
      alias   /var/www/rahasia/;
    }
```
Bagian ini tidak aman karena memungkinkan exploit [LFI](https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/nginx#alias-lfi-misconfiguration), yakni kita bisa memasukkan string yang akan di parse sebagai directory traversal. Misal ada file ```flag.txt``` dengan path ```/var/www/rahasia/flag.txt```, kita bisa mengaksesnya via url:
```
http://34.101.174.85:10005/flag../rahasia/flag.txt
```
Namun sebaiknya jangan gegabah karena untuk bisa mengakses ```/flag```, kita perlu mengaksesnya via ```internal-admin1.compfest.id```. Namun kalau kita coba akses langsung, server ini gak ada.

Terus harus gimana? 

**3. Faking your identity**

Yang jelas kita perlu malsuin identitas seolah-olah kita mengirimkan request dari ```internal-admin1.compfest.id```. Setelah searching dan bertanya ke chatGPT, ternyada ada caranya, yakni dengan set request header berikut:
```
Host: internal-admin1.compfest.id
```
Sebelum kita mencoba mengakses flagnya, kita tes dulu apakah dugaan kita soal exploit ini benar. Disini ku akan menggunakan **Postman**
![postman](internal%20web-2.JPG)
Ternyata benar. Kalau website ini secure harusnya dia return ```404```, tapi disini dia return ```403```. Berarti website ini bisa kita jebol.

Sekarang pertanyaannya, file apa yang harus kita akses?

**4. Get the Flag**

Hmm..coba kita akses ```index.html```
![failed attemp #1](internal%20web-3.JPG)
Kalau ```index.htm```?
![failed attemp #2](internal%20web-4.JPG)
Gagal maning. Ku penasaran apa kita bisa coba akses direktorinya aja ya?
![failed attemp #3](internal%20web-5.JPG)
Hmm..apa kurang ```/``` kah?
![flag](internal%20web-6.JPG)
Alhamdulillah dapat flagnya. Berarti bener ini pake exploit **LFI**.
```
COMPFEST15{N0w_y0u_kNoW_h0w_1t_w0rkss_R1ghttt??}
```
### Reflections
Permulaan menarik untuk belajar exploit NGINX terutama LFI.
  

---
[Back to home](../Readme.md)
